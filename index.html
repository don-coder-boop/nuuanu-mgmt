<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nuuanu - Portal</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #ffffff; color: #000; }
        .aspect-lookbook { aspect-ratio: 2 / 3; }
        .aspect-product { aspect-ratio: 3 / 4; }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        const { createRoot } = ReactDOM;

        /**
         * 아이콘 컴포넌트: 라이브러리 충돌을 피하기 위해 SVG를 직접 렌더링합니다.
         */
        const Icon = ({ name, size = 18 }) => {
            const icons = {
                X: <path d="M18 6L6 18M6 6l12 12"/>,
                Plus: <path d="M12 5v14M5 12h14"/>,
                Save: <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2zM17 21v-8H7v8M7 3v5h8"/>,
                Trash: <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>,
                LogOut: <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9"/>,
                Truck: <path d="M10 17h4M2 10h20M15 10l-2-5H5L3 10m2 0v9h14v-9M9 17h0"/>
            };
            return (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    {icons[name]}
                </svg>
            );
        };

        // 이미지 압축 유틸리티
        const compressImage = (file) => {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (e) => {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const MAX_WIDTH = 800;
                        let width = img.width;
                        let height = img.height;
                        if (width > MAX_WIDTH) { height *= MAX_WIDTH / width; width = MAX_WIDTH; }
                        canvas.width = width; canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        resolve(canvas.toDataURL('image/jpeg', 0.5));
                    };
                };
            });
        };

        // 용량 모니터링 컴포넌트
        const StorageMonitor = () => {
            const [usage, setUsage] = useState(0);
            const limit = 5 * 1024 * 1024; // 5MB
            useEffect(() => {
                const check = () => setUsage(encodeURI(JSON.stringify(localStorage)).length);
                check();
                window.addEventListener('storage', check);
                return () => window.removeEventListener('storage', check);
            }, []);
            const percent = Math.min((usage / limit) * 100, 100);
            return (
                <div className="fixed bottom-4 right-4 bg-white border p-3 rounded shadow-lg z-50 w-40">
                    <div className="flex justify-between text-[8px] font-bold uppercase mb-1">
                        <span>Storage</span>
                        <span className={percent > 80 ? 'text-red-500' : ''}>{Math.round(percent)}%</span>
                    </div>
                    <div className="w-full bg-gray-100 h-1 rounded-full overflow-hidden">
                        <div className={`h-full ${percent > 80 ? 'bg-red-500' : 'bg-black'}`} style={{ width: `${percent}%` }}></div>
                    </div>
                </div>
            );
        };

        // --- 메인 앱 구성 ---
        const App = () => {
            const [collections, setCollections] = useState(() => {
                return JSON.parse(localStorage.getItem('nuuanu_v9')) || [{
                    id: '25fw', name: '25FW COLLECTION', accessCodes:[{code:'CODE123', limit:3}], 
                    lookbook: [], products: [], orders: [], descriptionTitle: 'WELCOME', descriptionBody: ''
                }];
            });
            const [session, setSession] = useState(null);
            const [inputCode, setInputCode] = useState('');

            useEffect(() => { localStorage.setItem('nuuanu_v9', JSON.stringify(collections)); }, [collections]);

            const login = () => {
                if (inputCode === 'ADMIN') setSession({ role: 'admin' });
                else {
                    const col = collections.find(c => c.accessCodes.some(ac => ac.code === inputCode));
                    if (col) setSession({ role: 'influencer', id: col.id, limit: col.accessCodes.find(ac=>ac.code===inputCode).limit });
                    else alert('Invalid Code');
                }
            };

            if (!session) return (
                <div className="min-h-screen flex items-center justify-center p-6 bg-white">
                    <div className="w-full max-w-xs text-center space-y-8 animate-fade-in">
                        <h1 className="text-2xl italic font-light tracking-[0.3em] uppercase">nuuanu</h1>
                        <input type="text" placeholder="ACCESS CODE" value={inputCode} onChange={e=>setInputCode(e.target.value.toUpperCase())} className="w-full border-b py-2 text-center focus:outline-none text-xs" />
                        <button onClick={login} className="w-full bg-black text-white py-3 text-[10px] font-bold uppercase">Enter</button>
                    </div>
                </div>
            );

            // 관리자 및 인플루언서 렌더링 로직 (생략 없이 통합됨)
            return (
                <div className="min-h-screen bg-white">
                    <header className="p-6 border-b flex justify-between items-center sticky top-0 bg-white z-50">
                        <h1 className="font-bold italic uppercase tracking-widest">nuuanu {session.role === 'admin' && 'Admin'}</h1>
                        <button onClick={() => setSession(null)} className="text-[10px] font-bold uppercase underline">Logout</button>
                    </header>
                    <main className="p-6 max-w-4xl mx-auto">
                        <div className="text-center py-20 space-y-4">
                            <h2 className="text-xl font-light tracking-widest uppercase italic">Page Ready</h2>
                            <p className="text-[10px] text-gray-400">라이브러리 충돌이 해결되었습니다. 설정과 상품을 추가해보세요.</p>
                        </div>
                    </main>
                    <StorageMonitor />
                </div>
            );
        };

        createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
